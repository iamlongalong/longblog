<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="&#34;auto&#34;"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/longblog/static/img/favicon.png"><link rel="icon" href="/longblog/static/img/favicon.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="description" content=""><meta name="author" content="longalong"><meta name="keywords" content=""><title>使用lvm实现raid能力 - Longbao</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css"><link rel="stylesheet" href="/longblog/lib/hint/hint.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.7.2/styles/github-gist.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css"><link rel="stylesheet" href="/longblog/css/main.css"><script id="fluid-configs">var Fluid=window.Fluid||{},CONFIG={hostname:"iamlongalong.github.io",root:"/longblog/",version:"1.8.11",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"right",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},copy_btn:!0,image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/static/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!1,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null}},search_path:"/local-search.xml"}</script><script src="/longblog/js/utils.js"></script><script src="/longblog/js/color-schema.js"></script><meta name="generator" content="Hexo 5.4.0"></head><body><header style="height:35vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/longblog/">&nbsp;<strong>Longbao</strong>&nbsp;</a> <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/longblog/"><i class="iconfont icon-home-fill"></i> 首页</a></li><li class="nav-item"><a class="nav-link" href="/longblog/archives/"><i class="iconfont icon-archive-fill"></i> 归档</a></li><li class="nav-item"><a class="nav-link" href="/longblog/categories/"><i class="iconfont icon-category-fill"></i> 分类</a></li><li class="nav-item"><a class="nav-link" href="/longblog/tags/"><i class="iconfont icon-tags-fill"></i> 标签</a></li><li class="nav-item"><a class="nav-link" href="/longblog/about/"><i class="iconfont icon-user-fill"></i> 关于</a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" data-toggle="modal" data-target="#modalSearch">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div class="banner" id="banner" parallax="true" style="background:url(/longblog/static/img/default.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="page-header text-center fade-in-up"><span class="h2" id="subtitle" title="使用lvm实现raid能力"></span><div class="mt-3"><span class="post-meta mr-2"><i class="iconfont icon-author" aria-hidden="true"></i> longalong </span><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2021-12-02 16:36" pubdate>2021年12月2日 下午</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 2.4k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 38 分钟</span></div></div><div class="scroll-down-bar"><i class="iconfont icon-arrowdown"></i></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div class="py-5" id="board"><article class="post-content mx-auto"><h1 style="display:none">使用lvm实现raid能力</h1><div class="markdown-body"><h3 id="lvm是什么？"><a href="#lvm是什么？" class="headerlink" title="lvm是什么？"></a>lvm是什么？</h3><p>LVM 是 Logical Volume Manager（逻辑卷管理）的简写，它是Linux环境下对磁盘分区进行管理的一种机制，它由Heinz Mauelshagen在Linux 2.4内核上实现，最新版本为：稳定版1.0.5，开发版 1.1.0-rc2，以及LVM2开发版。Linux用户安装Linux操作系统时遇到的一个常见的难以决定的问题就是如何正确地评估各分区大小，以分配合适的硬盘空间。普通的磁盘分区管理方式在逻辑分区划分好之后就无法改变其大小，当一个逻辑分区存放不下某个文件时，这个文件因为受上层文件系统的限制，也不能跨越多个分区来存放，所以也不能同时放到别的磁盘上。而遇到出现某个分区空间耗尽时，解决的方法通常是使用符号链接，或者使用调整分区大小的工具，但这只是暂时解决办法，没有从根本上解决问题。随着Linux的逻辑卷管理功能的出现，这些问题都迎刃而解，用户在无需停机的情况下可以方便地调整各个分区大小。</p><h3 id="实验操作"><a href="#实验操作" class="headerlink" title="实验操作"></a>实验操作</h3><p>创建设备<br><img src="./../static/img/ali_ecs_lvm.png" srcset="/longblog/static/img/loading.gif" lazyload alt="阿里云ecs"></p><h4 id="查看磁盘状态"><a href="#查看磁盘状态" class="headerlink" title="查看磁盘状态"></a>查看磁盘状态</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@longtestlvm ~]# fdisk -l<br><br>磁盘 /dev/vda：21.5 GB, 21474836480 字节，41943040 个扇区<br>Units = 扇区 of 1 * 512 = 512 bytes<br>扇区大小(逻辑/物理)：512 字节 / 512 字节<br>I/O 大小(最小/最佳)：512 字节 / 512 字节<br>磁盘标签类型：dos<br>磁盘标识符：0x000bb9c1<br><br>   设备 Boot      Start         End      Blocks   Id  System<br>/dev/vda1   *        2048    41943039    20970496   83  Linux<br><br>磁盘 /dev/vdb：21.5 GB, 21474836480 字节，41943040 个扇区<br>Units = 扇区 of 1 * 512 = 512 bytes<br>扇区大小(逻辑/物理)：512 字节 / 512 字节<br>I/O 大小(最小/最佳)：512 字节 / 512 字节<br><br><br>磁盘 /dev/vdc：21.5 GB, 21474836480 字节，41943040 个扇区<br>Units = 扇区 of 1 * 512 = 512 bytes<br>扇区大小(逻辑/物理)：512 字节 / 512 字节<br>I/O 大小(最小/最佳)：512 字节 / 512 字节<br><br><br>磁盘 /dev/vdd：21.5 GB, 21474836480 字节，41943040 个扇区<br>Units = 扇区 of 1 * 512 = 512 bytes<br>扇区大小(逻辑/物理)：512 字节 / 512 字节<br>I/O 大小(最小/最佳)：512 字节 / 512 字节<br></code></pre></td></tr></table></figure><h4 id="升级yum"><a href="#升级yum" class="headerlink" title="升级yum"></a>升级yum</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@longtestlvm ~]# yum update -y<br></code></pre></td></tr></table></figure><h4 id="安装lvm2"><a href="#安装lvm2" class="headerlink" title="安装lvm2"></a>安装lvm2</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@longtestlvm ~]# yum install lvm2 -y<br></code></pre></td></tr></table></figure><h4 id="创建物理卷"><a href="#创建物理卷" class="headerlink" title="创建物理卷"></a>创建物理卷</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@longtestlvm ~]# pvcreate /dev/vdb /dev/vdc<br>  Physical volume &quot;/dev/vdb&quot; successfully created.<br>  Physical volume &quot;/dev/vdc&quot; successfully created.<br></code></pre></td></tr></table></figure><h4 id="查看物理卷"><a href="#查看物理卷" class="headerlink" title="查看物理卷"></a>查看物理卷</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@longtestlvm ~]# pvdisplay<br>  &quot;/dev/vdc&quot; is a new physical volume of &quot;20.00 GiB&quot;<br>  --- NEW Physical volume ---<br>  PV Name               /dev/vdc<br>  VG Name<br>  PV Size               20.00 GiB<br>  Allocatable           NO<br>  PE Size               0<br>  Total PE              0<br>  Free PE               0<br>  Allocated PE          0<br>  PV UUID               avPba4-Z0J5-bhWC-4poS-x5oG-qt4P-4xUJnn<br><br>  &quot;/dev/vdb&quot; is a new physical volume of &quot;20.00 GiB&quot;<br>  --- NEW Physical volume ---<br>  PV Name               /dev/vdb<br>  VG Name<br>  PV Size               20.00 GiB<br>  Allocatable           NO<br>  PE Size               0<br>  Total PE              0<br>  Free PE               0<br>  Allocated PE          0<br>  PV UUID               exRn9W-AQKP-7rTc-EwAf-YtsK-MW0O-HHJ0sk<br></code></pre></td></tr></table></figure><h4 id="查看物理卷简要信息"><a href="#查看物理卷简要信息" class="headerlink" title="查看物理卷简要信息"></a>查看物理卷简要信息</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@longtestlvm ~]# pvs<br>  PV         VG Fmt  Attr PSize  PFree<br>  /dev/vdb      lvm2 ---  20.00g 20.00g<br>  /dev/vdc      lvm2 ---  20.00g 20.00g<br></code></pre></td></tr></table></figure><h4 id="查看物理卷简要信息-1"><a href="#查看物理卷简要信息-1" class="headerlink" title="查看物理卷简要信息"></a>查看物理卷简要信息</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@longtestlvm ~]# pvscan<br>  PV /dev/vdc                      lvm2 [20.00 GiB]<br>  PV /dev/vdb                      lvm2 [20.00 GiB]<br>  Total: 2 [40.00 GiB] / in use: 0 [0   ] / in no VG: 2 [40.00 GiB]<br></code></pre></td></tr></table></figure><h4 id="创建逻辑卷组"><a href="#创建逻辑卷组" class="headerlink" title="创建逻辑卷组"></a>创建逻辑卷组</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@longtestlvm ~]# vgcreate vglong /dev/vdc /dev/vdb<br>  Volume group &quot;vglong&quot; successfully created<br></code></pre></td></tr></table></figure><p>查看逻辑卷组信息</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@longtestlvm ~]# vgdisplay<br>  --- Volume group ---<br>  VG Name               vglong<br>  System ID<br>  Format                lvm2<br>  Metadata Areas        2<br>  Metadata Sequence No  1<br>  VG Access             read/write<br>  VG Status             resizable<br>  MAX LV                0<br>  Cur LV                0<br>  Open LV               0<br>  Max PV                0<br>  Cur PV                2<br>  Act PV                2<br>  VG Size               39.99 GiB<br>  PE Size               4.00 MiB<br>  Total PE              10238<br>  Alloc PE / Size       0 / 0<br>  Free  PE / Size       10238 / 39.99 GiB<br>  VG UUID               4flIRX-1oVR-MBy5-I2YT-gY2R-Eqaf-PmFq7b<br></code></pre></td></tr></table></figure><h4 id="查看逻辑卷组简要信息"><a href="#查看逻辑卷组简要信息" class="headerlink" title="查看逻辑卷组简要信息"></a>查看逻辑卷组简要信息</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@longtestlvm ~]# vgs<br>  VG     #PV #LV #SN Attr   VSize  VFree<br>  vglong   2   0   0 wz--n- 39.99g 39.99g<br></code></pre></td></tr></table></figure><h4 id="创建逻辑卷"><a href="#创建逻辑卷" class="headerlink" title="创建逻辑卷"></a>创建逻辑卷</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@longtestlvm ~]# lvcreate -L 30G -n lvlong vglong<br>  Logical volume &quot;lvlong&quot; created.<br></code></pre></td></tr></table></figure><h4 id="查看逻辑卷"><a href="#查看逻辑卷" class="headerlink" title="查看逻辑卷"></a>查看逻辑卷</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@longtestlvm ~]# lvdisplay<br>  --- Logical volume ---<br>  LV Path                /dev/vglong/lvlong<br>  LV Name                lvlong<br>  VG Name                vglong<br>  LV UUID                x7iFjg-QSem-vzfu-jAkV-V0lI-50P3-tHD3Hz<br>  LV Write Access        read/write<br>  LV Creation host, time longtestlvm, 2021-10-12 14:00:09 +0800<br>  LV Status              available<br><span class="hljs-meta">  #</span><span class="bash"> open                 0</span><br>  LV Size                30.00 GiB<br>  Current LE             7680<br>  Segments               2<br>  Allocation             inherit<br>  Read ahead sectors     auto<br>  - currently set to     8192<br>  Block device           252:0<br></code></pre></td></tr></table></figure><h4 id="查看逻辑卷简要信息"><a href="#查看逻辑卷简要信息" class="headerlink" title="查看逻辑卷简要信息"></a>查看逻辑卷简要信息</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@longtestlvm ~]# lvs<br>  LV     VG     Attr       LSize  Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert<br>  lvlong vglong -wi-a----- 30.00g<br></code></pre></td></tr></table></figure><h4 id="查看磁盘"><a href="#查看磁盘" class="headerlink" title="查看磁盘"></a>查看磁盘</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@longtestlvm ~]# fdisk -l<br><br>磁盘 /dev/vda：21.5 GB, 21474836480 字节，41943040 个扇区<br>Units = 扇区 of 1 * 512 = 512 bytes<br>扇区大小(逻辑/物理)：512 字节 / 512 字节<br>I/O 大小(最小/最佳)：512 字节 / 512 字节<br>磁盘标签类型：dos<br>磁盘标识符：0x000bb9c1<br><br>   设备 Boot      Start         End      Blocks   Id  System<br>/dev/vda1   *        2048    41943039    20970496   83  Linux<br><br>磁盘 /dev/vdb：21.5 GB, 21474836480 字节，41943040 个扇区<br>Units = 扇区 of 1 * 512 = 512 bytes<br>扇区大小(逻辑/物理)：512 字节 / 512 字节<br>I/O 大小(最小/最佳)：512 字节 / 512 字节<br><br><br>磁盘 /dev/vdc：21.5 GB, 21474836480 字节，41943040 个扇区<br>Units = 扇区 of 1 * 512 = 512 bytes<br>扇区大小(逻辑/物理)：512 字节 / 512 字节<br>I/O 大小(最小/最佳)：512 字节 / 512 字节<br><br><br>磁盘 /dev/vdd：21.5 GB, 21474836480 字节，41943040 个扇区<br>Units = 扇区 of 1 * 512 = 512 bytes<br>扇区大小(逻辑/物理)：512 字节 / 512 字节<br>I/O 大小(最小/最佳)：512 字节 / 512 字节<br><br><br>磁盘 /dev/mapper/vglong-lvlong：32.2 GB, 32212254720 字节，62914560 个扇区<br>Units = 扇区 of 1 * 512 = 512 bytes<br>扇区大小(逻辑/物理)：512 字节 / 512 字节<br>I/O 大小(最小/最佳)：512 字节 / 512 字节<br></code></pre></td></tr></table></figure><h4 id="格式化虚拟磁盘"><a href="#格式化虚拟磁盘" class="headerlink" title="格式化虚拟磁盘"></a>格式化虚拟磁盘</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@longtestlvm ~]# mkfs.ext4 /dev/vglong/lvlong<br>mke2fs 1.42.9 (28-Dec-2013)<br>文件系统标签=<br>OS type: Linux<br>块大小=4096 (log=2)<br>分块大小=4096 (log=2)<br>Stride=0 blocks, Stripe width=0 blocks<br>1966080 inodes, 7864320 blocks<br>393216 blocks (5.00%) reserved for the super user<br>第一个数据块=0<br>Maximum filesystem blocks=2155872256<br>240 block groups<br>32768 blocks per group, 32768 fragments per group<br>8192 inodes per group<br>Superblock backups stored on blocks:<br>        32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208,<br>        4096000<br><br>Allocating group tables: 完成<br>正在写入inode表: 完成<br>Creating journal (32768 blocks): 完成<br>Writing superblocks and filesystem accounting information: 完成<br></code></pre></td></tr></table></figure><h4 id="挂载磁盘"><a href="#挂载磁盘" class="headerlink" title="挂载磁盘"></a>挂载磁盘</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@longtestlvm mnt]# mkdir longtestlvm<br><br>[root@longtestlvm mnt]# mount /dev/mapper/vglong-lvlong /mnt/longtestlvm/<br></code></pre></td></tr></table></figure><h4 id="创建一个文件试试"><a href="#创建一个文件试试" class="headerlink" title="创建一个文件试试"></a>创建一个文件试试</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@longtestlvm longtestlvm]# mkdir -p /mnt/longtestlvm/longtest<br><br>[root@longtestlvm longtestlvm]# echo &#x27;hello world \n nihao a&#x27; &gt; /mnt/longtestlvm/longtest/a.txt<br></code></pre></td></tr></table></figure><h4 id="查看磁盘挂载"><a href="#查看磁盘挂载" class="headerlink" title="查看磁盘挂载"></a>查看磁盘挂载</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@longtestlvm mnt]# df -h<br>文件系统                   容量  已用  可用 已用% 挂载点<br>devtmpfs                   3.9G     0  3.9G    0% /dev<br>tmpfs                      3.9G     0  3.9G    0% /dev/shm<br>tmpfs                      3.9G  572K  3.9G    1% /run<br>tmpfs                      3.9G     0  3.9G    0% /sys/fs/cgroup<br>/dev/vda1                   20G  2.4G   17G   13% /<br>tmpfs                      783M     0  783M    0% /run/user/0<br>/dev/mapper/vglong-lvlong   30G   45M   28G    1% /mnt/longtestlvm<br></code></pre></td></tr></table></figure><h4 id="查看文件大小"><a href="#查看文件大小" class="headerlink" title="查看文件大小"></a>查看文件大小</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@longtestlvm mnt]# du -ah<br>4.0K        ./longtestlvm/longtest/a.txt<br>8.0K        ./longtestlvm/longtest<br>16K        ./longtestlvm/lost+found<br>28K        ./longtestlvm<br>32K        .<br></code></pre></td></tr></table></figure><h4 id="扩展逻辑卷容量"><a href="#扩展逻辑卷容量" class="headerlink" title="扩展逻辑卷容量"></a>扩展逻辑卷容量</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@longtestlvm ~]# lvextend -L +4G /dev/vglong/lvlong<br>  Size of logical volume vglong/lvlong changed from 30.00 GiB (7680 extents) to 34.00 GiB (8704 extents).<br>  Logical volume vglong/lvlong successfully resized.<br></code></pre></td></tr></table></figure><h4 id="resize逻辑卷"><a href="#resize逻辑卷" class="headerlink" title="resize逻辑卷"></a>resize逻辑卷</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@longtestlvm ~]# resize2fs /dev/vglong/lvlong<br>resize2fs 1.42.9 (28-Dec-2013)<br>Filesystem at /dev/vglong/lvlong is mounted on /mnt/longtestlvm; on-line resizing required<br>old_desc_blocks = 4, new_desc_blocks = 5<br>The filesystem on /dev/vglong/lvlong is now 8912896 blocks long.<br></code></pre></td></tr></table></figure><h4 id="扩展逻辑卷组"><a href="#扩展逻辑卷组" class="headerlink" title="扩展逻辑卷组"></a>扩展逻辑卷组</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@longtestlvm ~]# vgextend vglong /dev/vdd<br>  Physical volume &quot;/dev/vdd&quot; successfully created.<br>  Volume group &quot;vglong&quot; successfully extended<br></code></pre></td></tr></table></figure><h4 id="缩减逻辑卷"><a href="#缩减逻辑卷" class="headerlink" title="缩减逻辑卷"></a>缩减逻辑卷</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@longtestlvm ~]# umount /mnt/longtestlvm<br><br>[root@longtestlvm ~]# e2fsck -f /dev/vglong/lvlong<br>e2fsck 1.42.9 (28-Dec-2013)<br>第一步: 检查inode,块,和大小<br>第二步: 检查目录结构<br>第3步: 检查目录连接性<br>Pass 4: Checking reference counts<br>第5步: 检查簇概要信息<br>/dev/vglong/lvlong: 13/2228224 files (0.0% non-contiguous), 184932/8912896 blocks<br><br><br>[root@longtestlvm ~]#  resize2fs /dev/vglong/lvlong  10G<br>resize2fs 1.42.9 (28-Dec-2013)<br>Resizing the filesystem on /dev/vglong/lvlong to 2621440 (4k) blocks.<br>The filesystem on /dev/vglong/lvlong is now 2621440 blocks long.<br><br><br>[root@longtestlvm ~]# lvresize -L 10G /dev/vglong/lvlong<br>  WARNING: Reducing active logical volume to 10.00 GiB.<br>  THIS MAY DESTROY YOUR DATA (filesystem etc.)<br>Do you really want to reduce vglong/lvlong? [y/n]: y<br>  Size of logical volume vglong/lvlong changed from 34.00 GiB (8704 extents) to 10.00 GiB (2560 extents).<br>  Logical volume vglong/lvlong successfully resized.<br></code></pre></td></tr></table></figure><h4 id="缩减逻辑卷组"><a href="#缩减逻辑卷组" class="headerlink" title="缩减逻辑卷组"></a>缩减逻辑卷组</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@longtestlvm ~]# vgreduce vglong /dev/vdd<br></code></pre></td></tr></table></figure><h4 id="查看逻辑卷组"><a href="#查看逻辑卷组" class="headerlink" title="查看逻辑卷组"></a>查看逻辑卷组</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@longtestlvm ~]# vgdisplay<br>  --- Volume group ---<br>  VG Name               vglong<br>  System ID<br>  Format                lvm2<br>  Metadata Areas        2<br>  Metadata Sequence No  10<br>  VG Access             read/write<br>  VG Status             resizable<br>  MAX LV                0<br>  Cur LV                1<br>  Open LV               0<br>  Max PV                0<br>  Cur PV                2<br>  Act PV                2<br>  VG Size               39.99 GiB<br>  PE Size               4.00 MiB<br>  Total PE              10238<br>  Alloc PE / Size       2560 / 10.00 GiB<br>  Free  PE / Size       7678 / 29.99 GiB<br>  VG UUID               4flIRX-1oVR-MBy5-I2YT-gY2R-Eqaf-PmFq7b<br></code></pre></td></tr></table></figure><h4 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@longtestlvm ~]# lvremove /dev/vglong/lvlong<br>Do you really want to remove active logical volume vglong/lvlong? [y/n]: y<br>  Logical volume &quot;lvlong&quot; successfully removed<br><br>[root@longtestlvm ~]# vgremove vglong<br>  Volume group &quot;vglong&quot; successfully removed<br>  <br>[root@longtestlvm ~]# pvremove /dev/vdb /dev/vdc /dev/vdd<br>  Labels on physical volume &quot;/dev/vdb&quot; successfully wiped.<br>  Labels on physical volume &quot;/dev/vdc&quot; successfully wiped.<br>  Labels on physical volume &quot;/dev/vdd&quot; successfully wiped.<br></code></pre></td></tr></table></figure><h4 id="迁移"><a href="#迁移" class="headerlink" title="迁移"></a>迁移</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@longtestlvm ~]# pvmove /dev/vdb /dev/vdc<br></code></pre></td></tr></table></figure><h4 id="一些其他的内容"><a href="#一些其他的内容" class="headerlink" title="一些其他的内容"></a>一些其他的内容</h4><p>disk相关命令<br>fdisk 、 mkfs 、du 、 df 、dump2fs</p><h4 id="一些问题记录"><a href="#一些问题记录" class="headerlink" title="一些问题记录"></a>一些问题记录</h4><ol><li>已经将某个物理磁盘加入到 vg 中后，再将该物理盘进行分区<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@longtestlvm ~]# pvs<br>  WARNING: Device for PV cSASFg-dS4S-lrIP-hD3V-aJSR-EnzC-5bYp4B not found or rejected by a filter.<br>  Couldn&#x27;t find device with uuid cSASFg-dS4S-lrIP-hD3V-aJSR-EnzC-5bYp4B.<br>  PV         VG     Fmt  Attr PSize   PFree<br>  /dev/vdb   vglong lvm2 a--  &lt;20.00g &lt;20.00g<br>  /dev/vdc   vglong lvm2 a--  &lt;20.00g &lt;20.00g<br>  /dev/vdd1         lvm2 ---  100.00m 100.00m<br>  /dev/vdd2         lvm2 ---  100.00m 100.00m<br>  [unknown]  vglong lvm2 a-m  &lt;20.00g &lt;20.00g<br></code></pre></td></tr></table></figure></li></ol><p>解决办法：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@longtestlvm ~]# vgreduce --removemissing vglong --force<br>  Volume group &quot;vglong&quot; is already consistent.<br>  <br><br>[root@longtestlvm ~]# pvs<br>  PV         VG     Fmt  Attr PSize   PFree<br>  /dev/vdb   vglong lvm2 a--  &lt;20.00g &lt;20.00g<br>  /dev/vdc   vglong lvm2 a--  &lt;20.00g &lt;20.00g<br>  /dev/vdd1         lvm2 ---  100.00m 100.00m<br>  /dev/vdd2         lvm2 ---  100.00m 100.00m<br></code></pre></td></tr></table></figure><h4 id="整体的一些想法"><a href="#整体的一些想法" class="headerlink" title="整体的一些想法"></a>整体的一些想法</h4><p>对于 lvm，可以用于多个磁盘组合成一个磁盘，且提供 raid 能力，这给存储提供了超大容量的可能性，可以考虑作为NAS的一种实现。</p></div><hr><div><div class="post-metas mb-3"></div><p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p><div class="post-prevnext"><article class="post-prev col-6"><a href="/longblog/posts/21_12_02_%E7%A9%B7%E4%BA%BA%E6%89%8D%E4%BC%9A%E7%94%A8%E7%9A%84nas%E6%96%B9%E6%A1%88.html"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">穷人才会用的nas方案</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/longblog/posts/21_12_02_%E5%A6%82%E4%BD%95%E5%81%9A%E5%A5%BD%E5%8E%8B%E6%B5%8B.html"><span class="hidden-mobile">如何做好压测</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div></article></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p><div class="toc-body" id="toc-body"></div></div></div></div></div><a id="scroll-top-button" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer class="text-center mt-5 py-3"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div><div class="beian"><span><a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">备案: 粤ICP备2020131301号</a></span></div></footer><script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js"></script><script src="/longblog/js/events.js"></script><script src="/longblog/js/plugins.js"></script><script src="/longblog/js/img-lazyload.js"></script><script src="https://cdn.jsdelivr.net/npm/tocbot@4.12.3/dist/tocbot.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.1/anchor.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js"></script><script src="/longblog/js/local-search.js"></script><script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12/lib/typed.min.js"></script><script>!function(t,i){(0,Fluid.plugins.typing)(i.getElementById("subtitle").title)}(window,document)</script><script src="/longblog/static/js/showiframe.js"></script><script src="/longblog/js/boot.js"></script></body></html>