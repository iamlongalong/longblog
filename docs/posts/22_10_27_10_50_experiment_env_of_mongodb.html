<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="&#34;auto&#34;"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/longblog/static/img/favicon.png"><link rel="icon" href="/longblog/static/img/favicon.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="description" content=""><meta name="author" content="longalong"><meta name="keywords" content=""><title>mongodb实验环境搭建记录 - Longbao</title><link rel="stylesheet" href="https://static.longalong.cn/packages/blog/css/bootstrap.min.css"><link rel="stylesheet" href="https://static.longalong.cn/packages/blog/github-markdown.min.css"><link rel="stylesheet" href="/longblog/lib/hint/hint.min.css"><link rel="stylesheet" href="https://static.longalong.cn/packages/blog/styles/github-gist.min.css"><link rel="stylesheet" href="https://static.longalong.cn/packages/blog/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css"><link rel="stylesheet" href="/longblog/css/main.css"><script id="fluid-configs">var Fluid=window.Fluid||{},CONFIG={hostname:"iamlongalong.github.io",root:"/longblog/",version:"1.8.11",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"right",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},copy_btn:!0,image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/static/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!1,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null}},search_path:"/local-search.xml"}</script><script src="/longblog/js/utils.js"></script><script src="/longblog/js/color-schema.js"></script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/longblog/rss.xml" title="Longbao" type="application/atom+xml">
</head><body><header style="height:35vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/longblog/">&nbsp;<strong>Longbao</strong>&nbsp;</a> <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/longblog/"><i class="iconfont icon-home-fill"></i> 首页</a></li><li class="nav-item"><a class="nav-link" href="/longblog/archives/"><i class="iconfont icon-archive-fill"></i> 归档</a></li><li class="nav-item"><a class="nav-link" href="/longblog/categories/"><i class="iconfont icon-category-fill"></i> 分类</a></li><li class="nav-item"><a class="nav-link" href="/longblog/tags/"><i class="iconfont icon-tags-fill"></i> 标签</a></li><li class="nav-item"><a class="nav-link" href="/longblog/about/"><i class="iconfont icon-user-fill"></i> 关于</a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" data-toggle="modal" data-target="#modalSearch">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div class="banner" id="banner" parallax="true" style="background:url(/longblog/static/img/default.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="page-header text-center fade-in-up"><span class="h2" id="subtitle" title="mongodb实验环境搭建记录"></span><div class="mt-3"><span class="post-meta mr-2"><i class="iconfont icon-author" aria-hidden="true"></i> longalong </span><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2022-10-27 10:50" pubdate>2022年10月27日 上午</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 681 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 10 分钟</span></div></div><div class="scroll-down-bar"><i class="iconfont icon-arrowdown"></i></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div class="py-5" id="board"><article class="post-content mx-auto"><h1 style="display:none">mongodb实验环境搭建记录</h1><div class="markdown-body"><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>mongodb 是一个非常通用的文档型数据库，在后端开发过程中经常被用到。为了能够更好地掌握 mongodb，我们需要一套快速可使用的环境，用于开发、测试等。</p><h2 id="基本形态"><a href="#基本形态" class="headerlink" title="基本形态"></a>基本形态</h2><ul><li>docker</li><li>k8s</li></ul><h2 id="调研"><a href="#调研" class="headerlink" title="调研"></a>调研</h2><p>通过在 <a target="_blank" rel="noopener" href="https://hub.docker.com/search?q=mongodb">dockerhub</a> 上搜索 mongodb，发现有大量的镜像提供者。看到 mongo 官方的镜像 和 bitnami 提供的镜像 使用量最大，考虑到 bitnami 生态更加完善，因此选择 <a target="_blank" rel="noopener" href="https://hub.docker.com/r/bitnami/mongodb">bitnami/mongodb</a> 作为镜像。</p><h2 id="搭建过程"><a href="#搭建过程" class="headerlink" title="搭建过程"></a>搭建过程</h2><h3 id="docker"><a href="#docker" class="headerlink" title="docker"></a>docker</h3><h4 id="拉镜像"><a href="#拉镜像" class="headerlink" title="拉镜像"></a>拉镜像</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker pull bitnami/mongodb:6.0<br></code></pre></td></tr></table></figure><h4 id="直接通过-docker-运行"><a href="#直接通过-docker-运行" class="headerlink" title="直接通过 docker 运行"></a>直接通过 docker 运行</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 创建网桥</span><br>docker network create mongonet --driver bridge<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -d \<br>    -e ALLOW_EMPTY_PASSWORD=yes \<br>    -e MONGODB_EXTRA_FLAGS=&#x27;--wiredTigerCacheSizeGB=2&#x27; \<br>    -e MONGODB_ENABLE_JOURNAL=true \<br>    -e MONGODB_ROOT_PASSWORD=password123 \<br>    -e MONGODB_USERNAME=testuser \<br>    -e MONGODB_PASSWORD=123456 \<br>    -e MONGODB_DATABASE=testdb \<br>    -e MONGODB_REPLICA_SET_MODE=primary \<br>    -e MONGODB_REPLICA_SET_NAME=testreplicaset \<br>    -e MONGODB_PORT_NUMBER=27017 \<br>    -v /data/mongotest:/bitnami/mongodb \<br>    -v /data/mongotest/init:/docker-entrypoint-initdb.d \<br>    --name mongomaster \<br>    --network mongonet \<br>    -p 27017:27017 \<br>    bitnami/mongodb:6.0<br></code></pre></td></tr></table></figure><h4 id="配置-docker-compose-yaml-文件"><a href="#配置-docker-compose-yaml-文件" class="headerlink" title="配置 docker-compose.yaml 文件"></a>配置 docker-compose.yaml 文件</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3.3&#x27;</span><br><br><span class="hljs-attr">networks:</span><br>  <span class="hljs-attr">mongonet:</span><br>    <span class="hljs-attr">driver:</span> <span class="hljs-string">bridge</span><br><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">mongodb:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">docker.io/bitnami/mongodb:6.0</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;27017:27017&#x27;</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;/data/mongotest:/bitnami/postgresql&#x27;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;/data/mongotest/init:/docker-entrypoint-initdb.d&#x27;</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;ALLOW_EMPTY_PASSWORD=yes&#x27;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;MONGODB_EXTRA_FLAGS=&quot;--wiredTigerCacheSizeGB=2&quot;&#x27;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;MONGODB_ENABLE_JOURNAL=true&#x27;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;MONGODB_ROOT_PASSWORD=password123&#x27;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;MONGODB_USERNAME=testuser&#x27;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;MONGODB_PASSWORD=123456&#x27;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;MONGODB_DATABASE=testdb&#x27;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;MONGODB_REPLICA_SET_MODE=primary&#x27;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;MONGODB_REPLICA_SET_NAME=testreplicaset&#x27;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;MONGODB_PORT_NUMBER=27017&#x27;</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">mongonet</span><br><br></code></pre></td></tr></table></figure><ul><li><input disabled type="checkbox"> 做mongodb从库搭建的实验</li><li><input disabled type="checkbox"> 做mongodb集群搭建实验</li></ul><h3 id="k8s"><a href="#k8s" class="headerlink" title="k8s"></a>k8s</h3><p>charts 同样选择 <a target="_blank" rel="noopener" href="https://github.com/bitnami/charts/tree/main/bitnami/mongodb">bitnami</a> 的库。</p><p>helm 下载及安装可以查看 <a href="/longblog/posts/22_10_20_12_10_experiment_env_of_postgresql.html#下载 helm" name="postgresql实验环境搭建">postgresql实验环境搭建</a></p><h4 id="查看-charts"><a href="#查看-charts" class="headerlink" title="查看 charts"></a>查看 charts</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">helm fetch bitnami/mongodb --untar<br><span class="hljs-comment"># 看情况修改需要的参数</span><br></code></pre></td></tr></table></figure><h4 id="修改mongodb密码等基本信息"><a href="#修改mongodb密码等基本信息" class="headerlink" title="修改mongodb密码等基本信息"></a>修改mongodb密码等基本信息</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># vim values.yaml</span><br><span class="hljs-attr">auth:</span><br>  <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">rootUser:</span> <span class="hljs-string">root</span><br>  <span class="hljs-attr">rootPassword:</span> <span class="hljs-string">&quot;123456&quot;</span><br>  <span class="hljs-attr">usernames:</span> [<span class="hljs-string">&quot;testuser&quot;</span>]<br>  <span class="hljs-attr">passwords:</span> [<span class="hljs-string">&quot;123456&quot;</span>]<br>  <span class="hljs-attr">databases:</span> [<span class="hljs-string">&quot;testdb&quot;</span>]<br></code></pre></td></tr></table></figure><blockquote><p>更详细的配置，可以参考 <a target="_blank" rel="noopener" href="https://github.com/bitnami/charts/tree/main/bitnami/mongodb">bitnami 的 github</a></p></blockquote><h4 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">helm install mongodb .<br></code></pre></td></tr></table></figure><h3 id="修改-service"><a href="#修改-service" class="headerlink" title="修改 service"></a>修改 service</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl edit svc mongodb<br><br><span class="hljs-comment"># 修改 Cluster 为 LoadBalancer/NodePort </span><br></code></pre></td></tr></table></figure><h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mongo mongodb://root:123456@xxx.xxx.xx.xx:27017/?authSource=admin<br></code></pre></td></tr></table></figure><h3 id="二进制"><a href="#二进制" class="headerlink" title="二进制"></a>二进制</h3><p>二进制也可以安装，可以在网上查下资料，姑且不做操作了。下面安装 mongo 是为了使用 client。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 设置 mongodb 源</span><br>cat &lt;&lt;<span class="hljs-string">eof &gt; /etc/yum.repos.d/mongodb-org-5.0.repo</span><br><span class="hljs-string">[mongodb-org-6.0]</span><br><span class="hljs-string">name=MongoDB Repository</span><br><span class="hljs-string">baseurl=https://repo.mongodb.org/yum/redhat/7Server/mongodb-org/6.0/x86_64/</span><br><span class="hljs-string">gpgcheck=1</span><br><span class="hljs-string">enabled=1</span><br><span class="hljs-string">gpgkey=https://www.mongodb.org/static/pgp/server-6.0.asc</span><br><span class="hljs-string">eof</span><br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 安装稳定版</span><br>yum install -y mongodb-org<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 当然也可以指定版本安装</span><br>sudo yum install -y mongodb-org-6.0.0 mongodb-org-server-6.0.0 mongodb-org-shell-6.0.0 mongodb-org-mongos-6.0.0 mongodb-org-tools-6.0.0<br></code></pre></td></tr></table></figure><h2 id="后续"><a href="#后续" class="headerlink" title="后续"></a>后续</h2><ul><li>增加 mongodb 的维护教程</li><li>增加 mongodb 的原理教程</li><li>增加 mongodb 监控的添加</li></ul><p>更详细的 mongodb 参数可以查看<a target="_blank" rel="noopener" href="https://mongodb.net.cn/manual/reference/parameters/">中文文档</a></p><hr><blockquote><p>Take up one idea. Make that one idea your life - think of it, dream of it, live on that idea. Let the brain, muscles, nerves, every part of your body, be full of that idea, and just leave every other idea alone. This is the way to success.<br>— <cite>Swami Vivekananda</cite></p></blockquote></div><hr><div><div class="post-metas mb-3"><div class="post-meta"><i class="iconfont icon-tags"></i> <a class="hover-with-bg" href="/longblog/tags/operation/">operation</a> <a class="hover-with-bg" href="/longblog/tags/mongodb/">mongodb</a> <a class="hover-with-bg" href="/longblog/tags/mongo/">mongo</a> <a class="hover-with-bg" href="/longblog/tags/database/">database</a> <a class="hover-with-bg" href="/longblog/tags/%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83/">实验环境</a></div></div><p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p><div class="post-prevnext"><article class="post-prev col-6"><a href="/longblog/posts/22_10_28_15_04_envolution_of_a_message_system.html"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">一个消息系统的进化史</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/longblog/posts/22_10_25_12_13_experiment_env_of_mysql.html"><span class="hidden-mobile">mysql实验环境搭建</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div></article></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p><div class="toc-body" id="toc-body"></div></div></div></div></div><a id="scroll-top-button" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer class="text-center mt-5 py-3"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div><div class="beian"><span><a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">备案: 粤ICP备2020131301号</a></span></div></footer><script src="https://static.longalong.cn/packages/blog/nprogress.min.js"></script><link rel="stylesheet" href="https://static.longalong.cn/packages/blog/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://static.longalong.cn/packages/blog/jquery.min.js"></script><script src="https://static.longalong.cn/packages/blog/js/bootstrap.min.js"></script><script src="/longblog/js/events.js"></script><script src="/longblog/js/plugins.js"></script><script src="/longblog/js/img-lazyload.js"></script><script src="https://static.longalong.cn/packages/blog/tocbot.min.js"></script><script src="https://static.longalong.cn/packages/blog/jquery.fancybox.min.js"></script><script src="https://static.longalong.cn/packages/blog/anchor.min.js"></script><script defer src="https://static.longalong.cn/packages/blog/clipboard.min.js"></script><script src="/longblog/js/local-search.js"></script><script src="https://static.longalong.cn/packages/blog/typed.min.js"></script><script>!function(t,i){(0,Fluid.plugins.typing)(i.getElementById("subtitle").title)}(window,document)</script><script src="/longblog/static/js/showiframe.js"></script><script src="/longblog/js/boot.js"></script></body></html>