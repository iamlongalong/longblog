---
title: 穷人才会用的nas方案
abbrlink: 21_12_02_穷人才会用的nas方案
date: 2021-12-02 17:05:35
tags:
---

## 背景
最近手机开始报存储空间快满了的问题，不知道有些什么文件占用了这么多空间，基本的解决办法是：把我将来需要的文件进行转移。例如之前的照片、视频等。自然而然想到了文件服务器。

## 可选方案
### 方案一
采用现有的公有网盘，例如 百度网盘，阿里网盘，方便直接。
问题： 百度网盘太慢了，会员又太贵了，划不来。阿里网盘现在的客户端还很不完善。另外，可能还会有资料隐私问题、莫名关停服务等问题(参考360网盘)。
结论：对于一些公共资料可以采用这种方案，例如一些课程学习资料等。等阿里网盘发育一段时间再存一些公共资料。

### 方案二
采用OSS，自建私有网盘，保证安全私密性。
问题：贵。oss存储费用 + 流量费，对于可能需要长期存储的文件来说，成本太高了。
结论：不行不行，穷。

### 方案三
采用自有硬盘，搭建文件服务器，成本低，私密性高。
问题：
1.  搭建和维护相对复杂。
2. 存储安全性需要考虑。

由于成本问题以及私密性问题，最终采用方案三。

## 具体可选实施方案

### 购买成熟系统
现在市场上关于 家庭NAS 系统，主要有 威联通、群晖、铁威马 这些。
优点就是 简单、方便、功能齐全。缺点就是 价格贵！
![群晖、威联通价格](https://static.longalong.cn/img/tieweima_nas_price.png)

![西部数据价格](https://static.longalong.cn/img/xishu_nas_price.png)

其实直接购买的方式优势还是非常明显的，一个群晖，不仅可以作为文件服务器，还可以用作下载机、家庭影院、简单办公系统，由于其本质是一个linux系统的封装，因此也可以跑很多的服务(例如docker)，类似于买了一台家用服务器，而文件存储服务只是这个服务器的一个小服务而已。


### 使用塔式/家用主机
和直接购买群晖这类机器类似的另一种方案，就是直接使用家用主机。
家用主机的好处就是，大部分家庭中都有现有的设备，也就不需要单独花钱了，多配一块硬盘就可以了。

### 使用树莓派
使用主机作为文件服务器有一个弊端，就是能耗太高了，一个家用主机至少也是80W以上，常年开机的话，也不是一个环保的方式(主要可能还是成本太高)。
如果使用树莓派的话，则更加轻量，树莓派的运行功耗仅 5W ，放在某个小角落，一年下来问题也不大。
另外，树莓派可以提供的服务也可以非常非常多，甚至可以用来做智能家居控制器。

### 使用路由器
在考虑树莓派的网络拓扑时，想到了为何不直接使用路由器作为文件服务器？
由于路由器的内核也是类unix系统，因此也是可以直接作为文件服务器的。

### 结论
考虑到成本，最终选择使用 路由器 作为文件服务器的处理器。

## 具体操作方案

### 购买硬盘架、硬盘
要将路由器作为文件服务器，首先就要挂载硬盘。同时，考虑到文件安全的问题，需要采用冗余存储的方式，因此，需要至少2块硬盘。
要达到目标，有两种方案：
  - 使用usb hub + usb 转接口 + 串口硬盘
  - 使用usb hub + usb接口磁盘

由于usb接口的磁盘价格都比较高(例如u盘、ssd等)，因此选择第一种方案。
去淘宝搜了一下，一个usb hub大约16元，一个usb转接口大约27元 * 2，一个硬盘大约60元(500g) * 2，成本为190元。但这样有一个问题，用usb转接口的话，线太多了，得有两个12v的供电线以及2个sata转usb数据线，而且硬盘还是散乱的。
最终一狠心，花了150块大洋买了个双盘位硬盘架，这样就省去了usb hub和usb转接口的钱，最终算下来花了 270元。

### 安装同步软件
软件方面，有syncthing，非常合适，拥有多个操作系统的客户端。
参考官网： Syncthing

### 连接同步
路由器上和手机上都安装了syncthing后，进行两端绑定并共享文件夹。
然后设置同步策略为每小时扫描一次。

### 啥也不用管了
然后就去睡觉吧，保证syncthing后台进程，你就几个月都不用管他，如果哪天手机空间不足了，就去看看是否最新同步的，如果是，就把手机上的文件都清空吧。

## PS: 回头补一些图片